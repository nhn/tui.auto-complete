/*!
 * tui-auto-complete.min.js
 * @version 2.0.0
 * @author NHNEnt FE Development Lab <dl_javascript@nhnent.com>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery"),require("tui-code-snippet"),require("js-cookie")):"function"==typeof define&&define.amd?define(["jquery","tui-code-snippet","js-cookie"],e):"object"==typeof exports?exports.AutoComplete=e(require("jquery"),require("tui-code-snippet"),require("js-cookie")):(t.tui=t.tui||{},t.tui.AutoComplete=e(t.$,t.tui&&t.tui.util,t.Cookies))}(this,function(t,e,i){return function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="dist/",e(0)}([function(t,e,i){var s=i(2),o=i(6),n=i(1),a=i(3),r=i(4),h=i(5),u="_atcp_use_cookie",l=["resultListElement","searchBoxElement","orgQueryElement","formElement","subQuerySet","template","listConfig","actions","searchUrl"],c=/element/i,p=s.defineClass({init:function(t){this.options={},this.isUse=!0,this.queries=null,this.isIdle=!0,this._checkValidation(t),this._setOptions(t),this.dataManager=new a(this,this.options),this.inputManager=new r(this,this.options),this.resultManager=new h(this,this.options),this.setToggleBtnImg(this.isUse),this.setCookieValue(this.isUse)},flowMap:{NEXT:"next",PREV:"prev",FIRST:"first",LAST:"last"},watchInterval:300,_checkValidation:function(t){var e=s.isExisty,i=t.config;if(!e(i))throw new Error("No configuration #"+i);s.forEach(l,function(t){if(!e(i[t]))throw new Error(t+"does not not exist.")})},_setOptions:function(t){var e,i=t.config;i.toggleImg&&i.onoffTextElement?(e=o.get(i.cookieName),this.isUse="use"===e||!e):(this.isUse=!0,delete i.onoffTextElement),i.cookieName=i.cookieName||u,s.isFalsy(i.watchInterval)&&(i.watchInterval=this.watchInterval),s.forEach(i,function(t,e){c.test(e)?this.options[e]=n(t):this.options[e]=t},this)},request:function(t){this.dataManager.request(t)},getValue:function(){return this.inputManager.getValue()},setValue:function(t){this.inputManager.setValue(t)},setParams:function(t,e){this.inputManager.setParams(t,e)},setServerData:function(t){this.resultManager.draw(t)},setCookieValue:function(t){o.set(this.options.cookieName,t?"use":"notUse"),this.isUse=t,this.setToggleBtnImg(t)},setQueries:function(t){this.queries=[].concat(t)},isUseAutoComplete:function(){return this.isUse},isShowResultList:function(){return this.resultManager.isShowResultList()},setToggleBtnImg:function(t){this.inputManager.setToggleBtnImg(t)},hideResultList:function(){this.resultManager.hideResultList()},showResultList:function(){this.isUseAutoComplete()&&this.resultManager.showResultList()},moveNextResult:function(t){this.resultManager.moveNextResult(t)},changeOnOffText:function(t){this.resultManager.changeOnOffText(t)},setSearchApi:function(t){s.extend(this.options.searchApi,t)},clearReadyValue:function(){s.isExisty(this.readyValue)?this.request(this.readyValue):this.isIdle=!0,this.readyValue=null}});s.CustomEvents.mixin(p),t.exports=p},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e,i){var s=i(2),o=i(1),n="dataCallback",a="q",r=s.forEach,h=s.map,u=s.isEmpty,l=s.extend,c=s.defineClass({init:function(t,e){this.autoCompleteObj=t,this.options=e},request:function(t){var e,i=t.replace(/\s/g,""),s=this.autoCompleteObj;return t&&i?(this.options.searchApi[a]=t,void o.ajax(this.options.searchUrl,{dataType:"jsonp",jsonpCallback:n,data:this.options.searchApi,type:"get",success:o.proxy(function(t){try{e=this._getCollectionData(t),s.setQueries(t.query),s.setServerData(e),s.clearReadyValue()}catch(t){throw new Error("[DataManager] invalid response data.",t)}},this)})):void s.hideResultList()},_getCollectionData:function(t){var e=t.collections,i=[];return r(e,function(t){var e;u(t.items)||(e=this._getRedirectData(t),i.push({type:"title",values:[t.title]}),i=i.concat(e))},this),i},_getRedirectData:function(t){var e={type:t.type,index:t.index,dest:t.destination},i=t.items.slice(0,this.options.viewCount-1);return i=h(i,function(t){return l({values:t},e)})}});t.exports=c},function(t,e,i){var s=i(2),o=i(1),n=s.defineClass({keyCodeMap:{TAB:9,UP_ARROW:38,DOWN_ARROW:40,ESC:27},init:function(t,e){this.autoCompleteObj=t,this.options=e,this.isKeyMoving=!1,this.$searchBox=this.options.searchBoxElement,this.$toggleBtn=this.options.toggleBtnElement,this.$orgQuery=this.options.orgQueryElement,this.$formElement=this.options.formElement,this.prevValue="",this._attachEvent()},getValue:function(){return this.$searchBox.val()},setValue:function(t){this.$searchBox.val(t)},setParams:function(t,e){t&&s.isString(t)&&(t=t.split(",")),t&&!s.isEmpty(t)&&this._createParamSetByType(t,e)},_createParamSetByType:function(t,e){var i=this.options,n=i.listConfig[e],a=n.subQuerySet,r=n.staticParams,h=i.subQuerySet[a],u=i.staticParams[r];this.hiddens||this._createParamContainer(),s.forEach(t,function(t,e){var i=h[e];this.hiddens.append(o('<input type="hidden" name="'+i+'" value="'+t+'" />'))},this),this._createStaticParams(u)},_createStaticParams:function(t){t&&(t=t.split(","),s.forEach(t,function(t){var e=t.split("=");this.hiddens.append(o('<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />'))},this))},_createParamContainer:function(){this.hiddens=o('<div class="hidden-inputs"></div>').hide().appendTo(this.$formElement)},setToggleBtnImg:function(t){this.options.toggleImg&&!s.isEmpty(this.$toggleBtn)&&(t?this.$toggleBtn.attr("src",this.options.toggleImg.on):this.$toggleBtn.attr("src",this.options.toggleImg.off))},_attachEvent:function(){this.$searchBox.on({focus:o.proxy(this._onFocus,this),blur:o.proxy(this._onBlur,this),keydown:o.proxy(this._onKeyDown,this),click:o.proxy(this._onClick,this)}),s.isEmpty(this.$toggleBtn)||this.$toggleBtn.on("click",o.proxy(this._onClickToggle,this))},_setOrgQuery:function(t){this.$orgQuery.val(t)},_onClick:function(t){return!(!this.autoCompleteObj.getValue()||!this.autoCompleteObj.isUseAutoComplete())&&(this.autoCompleteObj.isShowResultList()||this.autoCompleteObj.showResultList(),t.stopPropagation(),!0)},_onFocus:function(){this.intervalId=setInterval(o.proxy(this._onWatch,this),this.options.watchInterval)},_onWatch:function(){var t=this.getValue();return t?void(this.isKeyMoving?(this._setOrgQuery(t),this.prevValue=t):this.prevValue!==t&&this._onChange()):(this.autoCompleteObj.hideResultList(),this.prevValue="",void this._setOrgQuery(""))},_onChange:function(){var t=this.autoCompleteObj,e=this.getValue();this.autoCompleteObj.isUseAutoComplete()&&(t.isIdle?(t.isIdle=!1,t.request(e)):(t.readyValue=e,t.showResultList()),this.prevValue=e)},_onBlur:function(){clearInterval(this.intervalId),this.intervalId=null},_onKeyDown:function(t){var e,i,s,o=this.autoCompleteObj;if(o.isUseAutoComplete()&&o.isShowResultList()){switch(i=this.keyCodeMap,s=o.flowMap,t.keyCode){case i.TAB:t.preventDefault(),e=t.shiftKey?s.NEXT:s.PREV;break;case i.DOWN_ARROW:e=s.NEXT;break;case i.UP_ARROW:e=s.PREV;break;case i.ESC:o.hideResultList()}e?(this.isKeyMoving=!0,o.moveNextResult(e)):this.isKeyMoving=!1}},_onClickToggle:function(t){var e=this.getValue();if(t.stopPropagation(),this.autoCompleteObj.isUseAutoComplete())this.autoCompleteObj.setCookieValue(!1),this.autoCompleteObj.changeOnOffText(!1),this.autoCompleteObj.hideResultList();else{if(this.autoCompleteObj.setCookieValue(!0),this.autoCompleteObj.changeOnOffText(!0),!e)return;this.prevValue!==e?this.autoCompleteObj.request(e):this.autoCompleteObj.showResultList()}}});t.exports=n},function(t,e,i){var s=i(2),o=i(1),n=10,a="[\\s]*",r=s.isEmpty,h=s.forEach,u=s.map,l=/[\\^$.*+?()[\]{}|]/,c="/s+/g",p=s.defineClass({init:function(t,e){this.autoCompleteObj=t,this.options=e,this.$resultList=e.resultListElement,this.viewCount=e.viewCount||n,this.$onOffTxt=e.onoffTextElement,this.mouseOverClass=e.mouseOverClass,this.flowMap=t.flowMap,this._attachEvent(),this.$selectedElement=o()},_deleteBeforeElement:function(){this.$selectedElement=o(),this.$resultList.hide().html("")},draw:function(t){var e=t.length;this._deleteBeforeElement(),e<1?this._hideBottomArea():this._makeResultList(t,e),this.showResultList()},_makeResultList:function(t,e){var i,s,n,a,r,h=this.options.template,u=this.options.listConfig,l=this.options.useTitle&&!!h.title;for(a=0;a<e;a+=1)r=t[a],s=r.index,i=u[s]?h[u[s].template]:h.defaults,("title"!==r.type||(i=h.title,l))&&(n=this._getTmplData(i.attr,r),o(this._applyTemplate(i.element,n)).data({params:n.params,index:s}).appendTo(this.$resultList))},_getTmplData:function(t,e){var i={},o=e.values||null;return s.isString(e)?(i[t[0]]=e,i):(h(t,function(t,e){i[t]=o[e]}),t.length<o.length&&(i.params=o.slice(t.length)),i)},isShowResultList:function(){return"block"===this.$resultList.css("display")},hideResultList:function(){this.$resultList.hide(),this._hideBottomArea(),this.autoCompleteObj.isIdle=!0,this.autoCompleteObj.fire("close")},showResultList:function(){this.$resultList.show(),this._showBottomArea()},moveNextResult:function(t){var e,i=this.$selectedElement;r(i)||i.removeClass(this.mouseOverClass),i=this.$selectedElement=this._orderElement(t),e=i.find(".keyword-field").text(),e?(i.addClass(this.mouseOverClass),this.autoCompleteObj.setValue(e),this._setSubmitOption()):this.moveNextResult(t)},changeOnOffText:function(t){t?this.$onOffTxt.text("자동완성 끄기"):this.$onOffTxt.text("자동완성 켜기")},_attachEvent:function(){this.$resultList.on({mouseover:o.proxy(this._onMouseOver,this),click:o.proxy(this._onClick,this)}),this.$onOffTxt&&this.$onOffTxt.on("click",o.proxy(function(){this._useAutoComplete()},this)),o(document).on("click",o.proxy(function(){this.hideResultList()},this))},_applyTemplate:function(t,e){return s.forEach(e,function(e,i){"subject"===i&&(e=this._highlight(e)),t=t.replace(new RegExp("@"+i+"@","g"),e)},this),t},_highlight:function(t){var e,i=this.autoCompleteObj.queries;return s.forEach(i,function(i){e||(e=t),e=this._makeStrong(e,i)},this),e||t},_makeStrong:function(t,e){var i,s;return!e||e.length<1?t:(i=e.replace(c,"").split(""),i=u(i,function(t){return l.test(t)?"\\"+t:t}),s=new RegExp(i.join(a),"gi"),t.replace(s,function(t){return"<strong>"+t+"</strong>"}))},_getFirst:function(){return this._orderStage(this.flowMap.FIRST)},_getLast:function(){return this._orderStage(this.flowMap.LAST)},_orderStage:function(t){var e=this.flowMap,i=this.$resultList.children();return t===e.FIRST?i.first():t===e.LAST?i.last():null},_orderElement:function(t){var e,i=this.$selectedElement;return t===this.flowMap.NEXT?(e=i.next(),e.length?e:this._getFirst()):(e=i.prev(),e.length?e:this._getLast())},_useAutoComplete:function(){var t=this.autoCompleteObj.isUseAutoComplete();this.changeOnOffText(t),this.autoCompleteObj.setCookieValue(t)},_showBottomArea:function(){this.$onOffTxt&&this.$onOffTxt.show()},_hideBottomArea:function(){this.$onOffTxt&&this.$onOffTxt.hide()},_setSubmitOption:function(t){var e=t?o(t).closest("li"):this.$selectedElement,i=e.data("params"),s=e.data("index"),n=this.options.listConfig[s],a=this.options.actions[n.action],r=this.options.formElement;r.attr("action",a),this._clearSubmitOption(),this.autoCompleteObj.setParams(i,s),this.autoCompleteObj.fire("change",{index:s,action:a,params:i})},_clearSubmitOption:function(){var t=this.options.formElement;t.find(".hidden-inputs").html("")},_onMouseOver:function(t){var e=o(t.target),i=this.$resultList.find("li"),s=e.closest("li");i.removeClass(this.mouseOverClass),s.find(".keyword-field").length&&s.addClass(this.mouseOverClass),this.$selectedElement=e},_onClick:function(t){var e=o(t.target),i=this.options.formElement,s=e.closest("li"),n=s.find(".keyword-field"),a=n.text();this.autoCompleteObj.setValue(a),a&&(this._setSubmitOption(e),i.submit())}});t.exports=p},function(t,e){t.exports=i}])});